<Page
    x:Class="StudyHub.WPF.Views.Pages.CourseListPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:StudyHub.WPF.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:wd="https://github.com/WPFDevelopersOrg/WPFDevelopers"
    Title="CourseListPage"
    Margin="20,10"
    d:DataContext="{d:DesignInstance local:CourseListPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    ScrollViewer.CanContentScroll="False"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ui:Card Padding="10">
            <StackPanel
                Height="50"
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                Orientation="Horizontal">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="100" />
                    </Grid.ColumnDefinitions>
                    <Label VerticalAlignment="Center" Content="课程分类:" />
                    <ComboBox
                        Grid.Column="1"
                        DisplayMemberPath="Text"
                        ItemsSource="{Binding ViewModel.Categories, Mode=OneWay}"
                        SelectedValue="{Binding ViewModel.SelectedCategoryId, Mode=TwoWay}"
                        SelectedValuePath="Id" />
                </Grid>

                <Grid Margin="20,0,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition MinWidth="250" />
                    </Grid.ColumnDefinitions>
                    <ui:TextBox
                        VerticalAlignment="Center"
                        Icon="{ui:SymbolIcon Search24,
                                             Filled=True}"
                        IconPlacement="Right"
                        PlaceholderText="搜索课程标题或描述"
                        Text="{Binding ViewModel.Keyword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                        <ui:TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding ViewModel.LoadCoursesCommand, Mode=OneTime}" />
                        </ui:TextBox.InputBindings>
                    </ui:TextBox>
                </Grid>
            </StackPanel>
        </ui:Card>

        <DockPanel
            Grid.Row="1"
            Margin="0,10"
            LastChildFill="False">
            <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                <ui:Button
                    Appearance="Success"
                    Command="{Binding ViewModel.SynchronizeCourseFromDirectoryCommand, Mode=OneTime}"
                    Content="同步课程" />
                <ui:Button
                    Margin="10,0,0,0"
                    Appearance="Info"
                    Command="{Binding ViewModel.OpenSelectedCourseInExplorerCommand, Mode=OneTime}"
                    Content="打开课程目录" />
            </StackPanel>

            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                <ui:Button
                    Appearance="Secondary"
                    Command="{Binding ViewModel.RefreshCommand, Mode=OneTime}"
                    Content="刷新"
                    Icon="{ui:FontIcon '&#xe60c;',
                                       FontFamily={StaticResource IconFont}}" />
                <ui:Button
                    Margin="10,0,0,0"
                    Appearance="Primary"
                    Command="{Binding ViewModel.CreateCommand, Mode=OneTime}"
                    Content="新增" />
                <ui:Button
                    Margin="10,0,0,0"
                    Appearance="Danger"
                    Command="{Binding ViewModel.DeleteSelectedCommand, Mode=OneTime}"
                    Content="删除选中" />
            </StackPanel>
        </DockPanel>

        <ui:DataGrid
            Grid.Row="2"
            AutoGenerateColumns="False"
            CanUserAddRows="False"
            CanUserDeleteRows="False"
            CanUserResizeColumns="True"
            CanUserResizeRows="False"
            CanUserSortColumns="False"
            EnableRowVirtualization="True"
            HorizontalScrollBarVisibility="Disabled"
            ItemsSource="{Binding ViewModel.CourseDataContext.Items, Mode=OneWay}"
            MinColumnWidth="100"
            MinRowHeight="40"
            MouseDoubleClick="DataGrid_MouseDoubleClick"
            SelectionUnit="FullRow">
            <ui:DataGrid.Columns>
                <DataGridTemplateColumn MinWidth="50" CanUserResize="False">
                    <DataGridTemplateColumn.Header>
                        <CheckBox
                            HorizontalAlignment="Center"
                            Command="{Binding ViewModel.CourseDataContext.SelectAllCheckedCommand, Mode=OneTime, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:CourseListPage}}}"
                            IsChecked="{Binding ViewModel.CourseDataContext.SelectAll, Mode=TwoWay, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:CourseListPage}}}"
                            IsThreeState="True" />
                    </DataGridTemplateColumn.Header>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox HorizontalAlignment="Center" IsChecked="{Binding IsChecked, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn
                    Width="100"
                    MinWidth="100"
                    Binding="{Binding Model.Title, Mode=OneWay}"
                    ElementStyle="{StaticResource CenteredTextBlockStyle}"
                    Header="标题" />
                <DataGridTextColumn
                    Width="100"
                    MinWidth="100"
                    Binding="{Binding Model.Category, Mode=OneWay}"
                    ElementStyle="{StaticResource CenteredTextBlockStyle}"
                    Header="分类" />
                <DataGridTextColumn
                    Width="60"
                    MinWidth="60"
                    Binding="{Binding Model.SectionCount, Mode=OneWay, StringFormat={}{0} 节}"
                    ElementStyle="{StaticResource CenteredTextBlockStyle}"
                    Header="课节" />
                <DataGridTextColumn
                    Width="150"
                    MinWidth="150"
                    Binding="{Binding Model.RelativePath, Mode=OneWay}"
                    ElementStyle="{StaticResource CenteredTextBlockStyle}"
                    Header="目录" />
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Model.Description, Mode=OneWay, Converter={StaticResource StringReplaceToOnceLineConverter}}"
                    ElementStyle="{StaticResource CenteredTextBlockStyle}"
                    Header="描述" />
            </ui:DataGrid.Columns>
        </ui:DataGrid>

        <wd:Pagination
            Grid.Row="3"
            Grid.Column="0"
            Margin="0,10,0,0"
            Count="{Binding ViewModel.Total, Mode=OneWay}"
            CountPerPage="{Binding ViewModel.CountPerPage, Mode=TwoWay}"
            Current="{Binding ViewModel.CurrentPage, Mode=TwoWay}"
            IsLite="True" />
    </Grid>
</Page>
